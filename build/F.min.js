F=function(a){return a instanceof F.Iterable?a:new F.Iterable("function"==typeof a.next?a:new F.ArrayIterator(a))},F.isEmptyValue=function(a){return"undefined"==typeof a.value},F.ArrayIterator=function(a){this._collection=a,this._index=-1},F.ArrayIterator.prototype.next=function(){return this._index++,{value:this._collection[this._index],done:this._index>=this._collection.length-1}},F.MapIterator=function(a,b){this._iter=a,this._func=b},F.MapIterator.prototype.next=function(){var a=this._iter.next();return F.isEmptyValue(a)?a:{value:this._func(a.value),done:a.done}},F.FilterIterator=function(a,b){this._iter=a,this._pred=b},F.FilterIterator.prototype.next=function(){var a=this._iter.next();return F.isEmptyValue(a)||this._pred(a.value)||(a.value=void 0),a},F.DropIterator=function(a,b){this._iter=a,this._count=b},F.DropIterator.prototype.next=function(){for(;this._count-->0;)this._iter.next();return this._iter.next()},F.DropWhileIterator=function(a,b){this._iter=a,this._pred=b,this._dropped=!1},F.DropWhileIterator.prototype.dropElements=function(){var a;do if(a=this._iter.next(),!F.isEmptyValue(a)&&!this._pred(a.value))return a;while(!a.done);return{done:!0}},F.DropWhileIterator.prototype.next=function(){return this._dropped?this._iter.next():(this._dropped=!0,this.dropElements())},F.ZipIterator=function(a,b){this._iter=a,this._zipIter=b},F.ZipIterator.prototype.next=function(){var a=this._iter.next(),b=this._zipIter.next(),c=a.done||b.done;return F.isEmptyValue(a)||F.isEmptyValue(b)?{done:!0}:{done:c,value:[a.value,b.value]}},F.ConcatIterator=function(a){this._iterators=a.slice(1),this._activeIter=a.length?a[0]:F([])._iter},F.ConcatIterator.prototype.next=function(){for(var a;;){if(a=this._activeIter.next(),!F.isEmptyValue(a)||!this._iterators.length)break;this._activeIter=this._iterators[0],this._iterators=this._iterators.slice(1)}return a.done&&this._iterators.length&&(a.done=!1,this._activeIter=this._iterators[0],this._iterators=this._iterators.slice(1)),a},F.Iterable=function(a){this._iter=a},F.Iterable.prototype.concat=function(){return F(new F.ConcatIterator([this._iter].concat(F(arguments).map(function(a){return F(a)._iter}).toArray())))},F.Iterable.prototype.flatten=function(){return F(new F.ConcatIterator(this.map(function(a){return F(a)._iter}).toArray()))},F.Iterable.prototype.map=function(a){return F(new F.MapIterator(this._iter,a))},F.Iterable.prototype.filter=function(a){return F(new F.FilterIterator(this._iter,a))},F.Iterable.prototype.zip=function(a){return F(new F.ZipIterator(this._iter,F(a)._iter))},F.Iterable.prototype.toArray=function(){var a,b=[];do a=this._iter.next(),F.isEmptyValue(a)||b.push(a.value);while(!a.done);return b},F.Iterable.prototype.toMap=function(){var a,b={};do a=this._iter.next(),F.isEmptyValue(a)||(b[a.value[0]]=a.value[1]);while(!a.done);return b},F.Iterable.prototype.partition=function(a){var b,c=[[],[]];do b=this._iter.next(),F.isEmptyValue(b)||(a(b.value)?c[0].push(b.value):c[1].push(b.value));while(!b.done);return c},F.Iterable.prototype.find=function(a){var b;do if(b=this._iter.next(),!F.isEmptyValue(b)&&a(b.value))return b.value;while(!b.done)},F.Iterable.prototype.findIndex=function(a){var b,c=-1;do if(b=this._iter.next(),c++,!F.isEmptyValue(b)&&a(b.value))return c;while(!b.done);return-1},F.Iterable.prototype.drop=function(a){return F(new F.DropIterator(this._iter,a))},F.Iterable.prototype.dropWhile=function(a){return F(new F.DropWhileIterator(this._iter,a))},F.Iterable.prototype.fold=function(a,b){var c;do c=this._iter.next(),F.isEmptyValue(c)||(b="undefined"==typeof b?c.value:a(b,c.value));while(!c.done);return b},F.Iterable.prototype.foreach=function(a){var b,c=0;do b=this._iter.next(),F.isEmptyValue(b)||a(b.value,c++,b.done);while(!b.done)},F.Iterable.prototype.reverse=function(){var a,b=[];do a=this._iter.next(),F.isEmptyValue(a)||b.unshift(a.value);while(!a.done);return F(b)},F.stream=function(){return F.lastStream=new F.Stream},F.Stream=function(){this.buffer=[],this.done=!1,this.onevent=function(){},this.oncancel=function(){}},F.Stream.prototype.push=function(a){this.buffer.push(a),this.onevent(a)},F.Stream.prototype.pushAll=function(a){for(var b=0;b<a.length;b++)this.buffer.push(a[b]);this.onevent(a)},F.Stream.prototype.next=function(){var a=this.buffer.splice(0,1)[0];return{value:a,done:this.done&&!this.buffer.length}},F.Stream.prototype.cancel=function(){this.done||(this.done=!0,this.push(),this.oncancel())},F.Iterable.prototype.pullStream=function(a,b){b||(b=P.alwaysTrue);var c=this;return new Promise(function(d){var e,f=[];a.onevent=function(){for(;a.buffer.length;)e=c._iter.next(),F.isEmptyValue(e)||f.push(e.value),(!b(e.value)||e.done)&&(a.cancel(),d(f))}})},P=function(){},P.and=function(){var a=arguments;return a&&Array.isArray(a[0])&&(a=a[0]),function(b){for(var c=0;c<a.length;c++)if(!a[c](b))return!1;return!0}},P.or=function(){var a=arguments;return a&&Array.isArray(a[0])&&(a=a[0]),function(b){for(var c=0;c<a.length;c++)if(a[c](b))return!0;return!1}},P.not=function(a){return function(b){return!a(b)}},P.alwaysTrue=function(){return!0},P.alwaysFalse=function(){return!1},P.isNull=function(a){return null==a},P.notNull=function(a){return null!=a},P.hasProperty=function(){var a=arguments;return function(b){for(var c=0;c<a.length;c++){if("undefined"==typeof b[a[c]])return!1;b=b[a[c]]}return!0}},P["in"]=function(a){return function(b){return-1!=a.indexOf(b)}},P.equalTo=function(a){return function(b){return b==a}},P.strongEqualTo=function(a){return function(b){return b===a}},P.instanceOf=function(a){return function(b){return b instanceof a}},P.on=function(){var a=arguments[arguments.length-1],b=arguments;return function(c){for(var d=0;d<b.length-1;d++){if("undefined"==typeof c[b[d]])return!1;c=c[b[d]]}return a(c)}},P.count=function(a){return function(){return a-->0?!0:!1}},P.limit=function(a){return function(){return--a>0?!0:!1}};